(()=>{"use strict";const t=[["W W W W W W W W W W W W W W W W W W W W","W       W                             W","W   E   W           E           E     W","W   E   W                             W","W       W           E     W W W W W W W","W     W W                             W","W                   E                 W","W         E E                   E     W","W                                     W","W W W W W W W W W W W W W W           W","W                         W           W","W     E     E             W     E     W","W                   E     W           W","W W W W W W W             W           W","W                         W     E     W","W               W W W W W W           W","W   P                     W           W","W                   E                 W","W         W W W                   E   W","W           W       E                 W","W W W W W W W W W W W W W W W W W W W W"],["W W W W W W W W W W W W W W W W W W W W","W       W                       W     W","W   E   W           E           E     W","W       W  E                          W","W       W          E          W W W W W","W               W         W           W","W               W   E                 W","W         E E   W               E     W","W               W                     W","W W W W     W W W W W W W W     W   E W","W                         W           W","W     E     E             W     E     W","W                   E     W           W","W W W W W W W             W           W","W       W                 W           W","W       W  E          W W W W     W W W","W   P   W                 W           W","W                   E                 W","W         W W W                   E   W","W           W       E                 W","W W W W W W W W W W W W W W W W W W W W"],["W W W W W W W W W W W W W W W W W W W W","W         W                           W","W   E     W              E  E  E      W","W         W    E                      W","W                     W         W     W","W                     W      E  W     W","W      E   W W W   W W W        W     W","W                     W         W     W","W                     W         W     W","W W W W W W     W W W W W W     W     W","W                         W           W","W     E     E             W     E     W","W                   E     W           W","W W W W W W W             W           W","W       W                 W     E     W","W       W   E     W W W W W W         W","W   P   W                             W","W                   E                 W","W         W W W                   E   W","W           W       E                 W","W W W W W W W W W W W W W W W W W W W W"]],e=new class{player(t,e){t.beginPath(),t.rect(20,35*e-20,25,40),t.fillStyle="#D95B43",t.fill(),t.beginPath(),t.rect(-40,-35*e-20,25,40),t.fillStyle="#D95B43",t.fill(),t.rotate(30*Math.PI/180),t.beginPath(),t.rect(40,-10,20,80),t.fillStyle="#C02942",t.fill(),t.rotate(-30*Math.PI/180),t.rotate(-50*Math.PI/180),t.beginPath(),t.rect(-55,-20,20,45),t.fillStyle="#C02942",t.fill(),t.rotate(50*Math.PI/180),t.beginPath(),t.rect(-60,-30,120,60),t.fillStyle="#53777A",t.fill(),t.beginPath(),t.rect(-12.5,30,25,70),t.fillStyle="gray",t.fill(),t.beginPath(),t.arc(0,0,40,0,2*Math.PI),t.fillStyle="#F1D4AF",t.fill(),t.rotate(-180*Math.PI/180),t.beginPath(),t.arc(0,0,37,0,180*Math.PI/180),t.fillStyle="#4d2600",t.fill(),t.rotate(180*Math.PI/180)}deadPlayer(t){t.beginPath(),t.rect(30,20,25,40),t.fillStyle="#D95B43",t.fill(),t.beginPath(),t.rect(-25,-65,25,40),t.fillStyle="#D95B43",t.fill(),t.rotate(25*Math.PI/180),t.beginPath(),t.rect(40,-5,20,80),t.fillStyle="#C02942",t.fill(),t.rotate(-25*Math.PI/180),t.rotate(-60*Math.PI/180),t.beginPath(),t.rect(-40,20,20,45),t.fillStyle="#C02942",t.fill(),t.rotate(60*Math.PI/180),t.beginPath(),t.rect(-60,-30,120,60),t.fillStyle="#53777A",t.fill(),t.beginPath(),t.arc(20,10,35,0,2*Math.PI),t.fillStyle="#F1D4AF",t.fill(),t.rotate(-170*Math.PI/180),t.beginPath(),t.arc(0,0,32,0,180*Math.PI/180),t.fillStyle="#4d2600",t.fill(),t.rotate(170*Math.PI/180)}enemy(t,e){t.beginPath(),t.rect(20,35*e-20,25,40),t.fillStyle="#79BD9A",t.fill(),t.beginPath(),t.rect(-40,-35*e-20,25,40),t.fillStyle="#79BD9A",t.fill(),t.beginPath(),t.rect(-50,-10,20,90),t.fillStyle="#3B8686",t.fill(),t.beginPath(),t.rect(30,-10,20,85),t.fillStyle="#3B8686",t.fill(),t.beginPath(),t.rect(-60,-30,120,60),t.fillStyle="#0B486B",t.fill(),t.beginPath(),t.arc(0,0,40,0,2*Math.PI),t.fillStyle="#CFF09E",t.fill(),t.rotate(-180*Math.PI/180),t.beginPath(),t.arc(0,0,37,0,180*Math.PI/180),t.fillStyle="#4d2600",t.fill(),t.rotate(180*Math.PI/180)}deadEnemy(t){t.beginPath(),t.rect(52,-30,25,40),t.fillStyle="#79BD9A",t.fill(),t.beginPath(),t.rect(26,-40,25,40),t.fillStyle="#79BD9A",t.fill(),t.beginPath(),t.rect(-25,35,20,90),t.fillStyle="#3B8686",t.fill(),t.beginPath(),t.rect(35,-40,20,85),t.fillStyle="#3B8686",t.fill(),t.beginPath(),t.rect(-42,-20,120,60),t.fillStyle="#0B486B",t.fill(),t.beginPath(),t.arc(10,5,35,0,2*Math.PI),t.fillStyle="#CFF09E",t.fill(),t.rotate(-170*Math.PI/180),t.beginPath(),t.arc(0,0,25,0,180*Math.PI/180),t.fillStyle="#4d2600",t.fill(),t.rotate(170*Math.PI/180)}health(t,e,i,s){let h;t.beginPath(),t.rect(i-50,s+60,100,5),t.strokeStyle="black",t.stroke(),h=e<=35?"red":e<=75?"orange":"lime",t.beginPath(),t.rect(i-50,s+60,e,5),t.fillStyle=h,t.fill()}},i=new class{intersection(t,e){return!(t.x+t.width<e.x||t.y+t.height<e.y||t.x>e.x+e.width||t.y>e.y+e.height)}beginRotationOffset(t,e,i,s){t.translate(-(-e+t.canvas.width/2),-(-i+t.canvas.height/2)),t.translate(t.canvas.width/2,t.canvas.height/2),t.rotate(s)}endRotationOffset(t,e,i,s){t.rotate(-s),t.translate(-t.canvas.width/2,-t.canvas.height/2),t.translate(+(-e+t.canvas.width/2),+(-i+t.canvas.height/2))}render(t,i){this.beginRotationOffset(t,i.x,i.y,i.angle),i.dead?"enemy"===i.type?e.deadEnemy(t):e.deadPlayer(t):"enemy"===i.type?e.enemy(t,i.position):e.player(t,i.position),this.endRotationOffset(t,i.x,i.y,i.angle),e.health(t,i.health,i.x,i.y)}},s=60,h=150,l=new class{arcWallVector({arcX:t,arcY:e,radius:i,wallX:s,wallY:h,size:l}){const W=Math.abs(t-s-l/2),a=Math.abs(e-h-l/2);if(W>l/2+i)return!1;if(a>l/2+i)return!1;if(W<=l/2)return!0;if(a<=l/2)return!0;const n=W-l/2,r=a-l/2;return n*n+r*r<=i*i}vector(t,e,i){const s={x:0,y:0};for(let l=0;l<i.length;l++){const W=i[l];if(this.arcWallVector({arcX:t,arcY:e,radius:60,wallX:W.x,wallY:W.y,size:h})){let i=t-(W.x+75),h=e-(W.y+75);const l=Math.sqrt(i*i+h*h);l>0&&(i/=l,h/=l,s.x+=i,s.y+=h)}}return s}};class W{constructor(t){this.type="enemy",this.bounding="arc",this.x=t.x*h,this.y=t.y*h,this.angle=0,this.position=0,this.incrementer=0,this.speed=3,this.sleep=!0,this.pushAlongVelocity={x:0,y:0},this.pushBulletVelocity={x:0,y:0},this.canBePushedByBullet=!0,this.lastVectorX=0,this.lastVectorY=0,this.health=100,this.dead=!1}pushAlong(t,e){this.pushAlongVelocity.x=10*t,this.pushAlongVelocity.y=10*e}pushByBullet(t){this.canBePushedByBullet&&(this.pushBulletVelocity.x=15*t.vectorX,this.pushBulletVelocity.y=15*t.vectorY,this.canBePushedByBullet=!1,this.health-=25,this.health=this.health<0?0:this.health,0==this.health&&(this.dead=!0))}update(t,e,h,W,a,n,r,o){if(this.sleep||this.dead)return;let c=e.x-this.x,y=e.y-this.y;e.dead?(c=this.lastVectorX,y=this.lastVectorY):(this.lastVectorX=c,this.lastVectorY=y);let d=Math.sqrt(c*c+y*y);if(d>0&&(c/=d,y/=d,d<800)){this.angle=Math.atan2(y,c)-90*Math.PI/180,this.x+=c*this.speed,this.y+=y*this.speed;const t=l.vector(this.x,this.y,W);this.x+=t.x*this.speed,this.y+=t.y*this.speed,this.incrementer+=this.speed,this.position=Math.sin(this.incrementer*Math.PI/180),d<100&&e.takeDamage(this)}if(Math.random()<=.1)for(let t=0;t<h.length;t++){const e=h[t];e!=this&&(c=e.x-this.x,y=e.y-this.y,d=Math.sqrt(c*c+y*y),0!=d&&d<100&&(c/=d,y/=d,e.pushAlong(c,y)))}this.pushAlongVelocity.x*=.9,this.pushAlongVelocity.y*=.9,this.x+=this.pushAlongVelocity.x,this.y+=this.pushAlongVelocity.y;const u={x:this.x-s,y:this.y-s,width:120,height:120};for(let t=0;t<a.bullets.length;t++){const e=a.bullets[t];i.intersection(u,e.bounds)&&(e.markToDelete=!0,this.pushByBullet(e))}this.pushBulletVelocity.x*=.9,this.pushBulletVelocity.y*=.9,this.x+=this.pushBulletVelocity.x,this.y+=this.pushBulletVelocity.y,Math.abs(this.pushBulletVelocity.x)<.5&&Math.abs(this.pushBulletVelocity.y)<.5&&(this.canBePushedByBullet=!0,this.pushBulletVelocity.x=0,this.pushBulletVelocity.y=0)}render(t){this.sleep||i.render(t,this)}}class a{constructor(t,e){this.bounding="box",this.x=t*h,this.y=e*h,this.sleep=!0,this.bounds={x:this.x,y:this.y,width:h,height:h}}render(t){this.sleep||(t.beginPath(),t.rect(this.x,this.y,h,h),t.fillStyle="#8fce00",t.fill())}}class n{constructor(t,e,i){this.vectorX=Math.cos(e.angle+90*Math.PI/180+5*i*Math.PI/180),this.vectorY=Math.sin(e.angle+90*Math.PI/180+5*i*Math.PI/180),this.x=e.x+this.vectorX*s*1.5,this.y=e.y+this.vectorY*s*1.5,this.radius=5,this.bounds={x:this.x-this.radius,y:this.y-this.radius,width:2*this.radius,height:2*this.radius},this.context=t,this.frames=0,this.markToDelete=!1}update(t){this.x+=25*this.vectorX,this.y+=25*this.vectorY,this.bounds.x=this.x-this.radius,this.bounds.y=this.y-this.radius,this.frames++,this.frames>15&&(this.markToDelete=!0);for(let e=0;e<t.length;e++){const s=t[e];i.intersection(s.bounds,this.bounds)&&(this.markToDelete=!0)}}render(){this.context.beginPath(),this.context.arc(this.x,this.y,this.radius,0,2*Math.PI),this.context.fillStyle="#F8CA00",this.context.fill()}}const r=document.querySelector("canvas#main").getContext("2d"),o=new class{constructor(t,e=0){this.x=0,this.y=0,this.offsetX=0,this.offsetY=0,this.context=t,this.frames=e}update(t,e){if(this.frames++,this.frames>=15){this.frames=0;const l={x:t.x-this.offsetX-this.context.canvas.width/2-this.size,y:t.y-this.offsetY-this.context.canvas.height/2-this.size,width:this.context.canvas.width+2*this.size,height:this.context.canvas.height+2*this.size};for(let t=0;t<e.length;t++){const W=e[t],a={};"arc"===W.bounding?(a.x=W.x-s,a.y=W.y-s,a.width=120,a.height=120):"box"===W.bounding&&(a.x=W.x,a.y=W.y,a.width=h,a.height=h),W.sleep=!i.intersection(a,l)}}}resize(){}preRender(t){const e=-t.x+this.context.canvas.width/2,i=-t.y+this.context.canvas.height/2,s=e-this.x,h=i-this.y;this.offsetX=this.x-e,this.offsetY=this.y-i,this.x+=s/10,this.y+=h/10,this.context.save(),this.context.translate(this.x,this.y)}postRender(){this.context.restore()}}(r),c={up:!1,down:!1,left:!1,right:!1},y={x:0,y:0,pressed:!1},d=new class{constructor(){this.playerPosition={x:0,y:0},this.enemyPositions=[],this.wallPositions=[]}generate(e=0){const i=t[e];for(let t=0;t<i.length;t++){const e=i[t];for(let i=0;i<e.length;i+=2){const s=i/2;switch(e[i]){case"W":this.wallPositions.push({x:s,y:t});break;case"E":this.enemyPositions.push({x:s,y:t});break;case"P":this.playerPosition={x:s,y:t}}}}}getPlayerPosition(){return this.playerPosition}getEnemyPositions(){return this.enemyPositions}getWallPositions(){return this.wallPositions}};d.generate();const u=[],f=[],g=[],x=new class{constructor(){this.canSpawn=!0,this.frames=0,this.bullets=[],this.indexesToDelete=[]}update(t,e,i,s){if(this.canSpawn&&!e.dead){if(s.pressed){for(let i=-3;i<=3;i++){const s=new n(t,e,i);this.bullets.push(s)}this.canSpawn=!1}}else this.frames++,this.frames>=60&&(this.frames=0,this.canSpawn=!0);this.indexesToDelete=[];for(let t=0;t<this.bullets.length;t++)this.bullets[t].update(i),this.bullets[t].markToDelete&&this.indexesToDelete.push(t);for(let t=0;t<this.indexesToDelete.length;t++)this.bullets.splice(this.indexesToDelete[t],1)}render(){for(let t=0;t<this.bullets.length;t++)this.bullets[t].render()}},p=new class{constructor(t,e){this.type="player",this.bounding="arc",this.x=t.x*h,this.y=t.y*h,this.angle=0,this.position=0,this.incrementer=0,this.speed=5,this.sleep=!0,this.invincible=!1,this.health=100,this.damage={x:0,y:0},this.dead=!1,this.gameover=e}takeDamage(t){if(!this.invincible){const e=this.x-t.x,i=this.y-t.y,s=Math.sqrt(e*e+i*i);s>0&&(this.damage.x=e/s*20,this.damage.y=i/s*20,this.invincible=!0,this.health-=25,this.health=this.health<0?0:this.health,0==this.health&&(this.dead=!0,setTimeout((()=>{this.gameover.style.display="block"}),1e3)))}}update(t,e,i,s,h,W,a,n){if(this.sleep||this.dead)return;let r=0;r+=a.up?1:0,r+=a.down?1:0,r+=a.left?1:0,r+=a.right?1:0;let o=this.speed;r>1&&(o/=Math.sqrt(2)),Math.abs(this.damage.x)!=0<Math.abs(this.damage.y)!=0?(this.damage.x*=.9,this.damage.y*=.9,this.x+=this.damage.x,this.y+=this.damage.y,Math.abs(this.damage.x)<.5&&Math.abs(this.damage.y)<.5&&(this.damage={x:0,y:0},this.invincible=!1)):(a.up&&(this.y-=o),a.down&&(this.y+=o),a.left&&(this.x-=o),a.right&&(this.x+=o));const c=l.vector(this.x,this.y,s);this.x+=c.x*o,this.y+=c.y*o;let y=W.offsetX+t.canvas.width/2-n.x,d=W.offsetY+t.canvas.height/2-n.y;const u=Math.sqrt(y*y+d*d);u>0&&(y/=u,d/=u,this.angle=Math.atan2(d,y)+90*Math.PI/180),(a.up||a.down||a.left||a.right)&&(this.incrementer+=this.speed),this.position=Math.sin(this.incrementer*Math.PI/180)}render(t){this.sleep||i.render(t,this)}}(d.getPlayerPosition(),document.querySelector("div.gameover"));u.push(p);for(let t=0;t<d.getEnemyPositions().length;t++){const e=new W(d.getEnemyPositions()[t]);u.push(e),g.push(e)}for(let t=0;t<d.getWallPositions().length;t++){const e=d.getWallPositions()[t],i=new a(e.x,e.y);u.push(i),f.push(i)}const P=()=>{var t,e;t=window.innerWidth,e=window.innerHeight,r.canvas.width=t,r.canvas.height=e,o.resize()};window.addEventListener("resize",P),P();const b=()=>{(()=>{o.update(p,u),x.update(r,p,f,y);for(let t=0;t<u.length;t++)void 0!==typeof u[t]&&"function"==typeof u[t].update&&u[t].update(r,p,g,f,x,o,c,y)})(),(()=>{r.clearRect(0,0,r.canvas.width,r.canvas.height),o.preRender(p),x.render();for(let t=0;t<u.length;t++)u[t].render(r);o.postRender()})(),requestAnimationFrame(b)};requestAnimationFrame(b),document.addEventListener("keydown",(t=>{switch(console.log({event:t}),t.key){case"w":c.up=!0;break;case"s":c.down=!0;break;case"a":c.left=!0;break;case"d":c.right=!0}})),document.addEventListener("keyup",(t=>{switch(t.key){case"w":c.up=!1;break;case"s":c.down=!1;break;case"a":c.left=!1;break;case"d":c.right=!1}})),document.addEventListener("mousemove",(t=>{y.x=t.clientX,y.y=t.clientY})),document.addEventListener("mousedown",(t=>{y.pressed=!0})),document.addEventListener("mouseup",(t=>{y.pressed=!1}))})();